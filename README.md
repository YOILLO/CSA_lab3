<h1> Кальвияйнен Ярослав, группа P33301 </h1>
<h4>Вариант:</h4>
asm | cisc | harv | hw | instr | binary | stream | mem | prob2

<h2>Язык программирования</h2>

<h3>Синтаксис:</h3>

```
<метка> ::= <слово>
<объявление метки> ::= <метка>: | <метка> :
<аргумент регистр> ::= 'r1' | 'r2' | 'r3' | 'r4'
<аргумент операнд> ::= o<число>
<аргумент адресс данных> ::= <число>
<аргумент адресс команд> ::= <число> | <метка>

<halt> ::= 'hlt'
<add> ::= 'add' <аргумент регистр> <аргумент регистр> | 'add' <аргумент регистр> <аргумент операнд> | 'add' <аргумент регистр> <аргумент адресс данных>
<sub> ::= 'sub' <аргумент регистр> <аргумент регистр> | 'sub' <аргумент регистр> <аргумент операнд> | 'sub' <аргумент регистр> <аргумент адресс данных>
<mul> ::= 'mul' <аргумент регистр> <аргумент регистр> | 'mul' <аргумент регистр> <аргумент операнд> | 'mul' <аргумент регистр> <аргумент адресс данных>
<div> ::= 'div' <аргумент регистр> <аргумент регистр> | 'div' <аргумент регистр> <аргумент операнд> | 'div' <аргумент регистр> <аргумент адресс данных>
<mod> ::= 'mod' <аргумент регистр> <аргумент регистр> | 'mod' <аргумент регистр> <аргумент операнд> | 'mod' <аргумент регистр> <аргумент адресс данных>
<mov> ::= 'mov' <аргумент регистр> <аргумент регистр>
<sv> ::=  'sv' <аргумент регистр> <аргумент адресс данных>
<ld> ::=  'ld' <аргумент регистр> <аргумент операнд> | 'ld' <аргумент регистр> <аргумент адресс данных>
<test> ::= 'test' <аргумент регистр>
<jmp> ::= 'jmp' <аргумент адресс команд>
<jz> ::= 'jz' <аргумент адресс команд>
<jn> ::= 'jn' <аргумент адресс команд>
<jc> ::= 'jc' <аргумент адресс команд>
<jv> ::= 'jv' <аргумент адресс команд>
<clz> ::= 'clz'
<cln> ::= 'cln'
<clv> ::= 'clv'
<clc> ::= 'clc'
<push> ::= 'push' <аргумент регистр>
<pop> ::= 'pop' <аргумент регистр>
<call> ::= 'jmp' <аргумент адресс команд>
<ret> ::= 'ret'
```

<h3>Семантика:</h3>

halt - команда отсановки процессора <br>
add - прибавить к регистру значнеие, первый аргемент: регистр, а второй, регистр или адресс ячейки памяти или операнд <br>
sub - вычесть из регистра <br>
mul - умножить на регистр <br>
div - поделить на регистр <br>
mod - остаток от деления на регистр <br>
mov - скопировать из регистра к регистру <br>
sv - сохранить в ячейку памяти <br>
ld - загрузить из ячейки памяти, или напрямую операнд <br>
test - выставить флаги состояния <br>
jmp - перейти по адрессу или метке <br>
jz - перейти по адрессу или метке если установлен флаг Z <br>
jn - перейти по адрессу или метке если установлен флаг N <br>
jc - перейти по адрессу или метке если установлен флаг C <br>
jv - перейти по адрессу или метке если установлен флаг V <br>
clz - очистить флаг Z <br>
cln - очистить флаг N <br>
clv - очистить флаг V <br>
clc - очистить флаг C <br>
push - положить в стек из регистра <br>
pop - положить из стека в регистр <br>
call - вызвать функцию по адресу <br>
ret - вернуться из функции

<h2>Память</h2>
В процессоре есть 2 банка памяти, для команд и для данных, адрес 32 разрядный (сейчас сделан 16 для скорости работы). В 2х последних ячейках памяти, лежат данные из очередей ввода-вывода, а после них, стек
<h2>Система комманд</h2>
Команды описаны выше. Каждая команда занимает от 1 до 3х слов. В первых 16 битах лежит номер команды, которая будет дальше, а во вторых, указание откуда брать операнды.
<h2>Транслятор</h2>
Транслятор имеет 2 аргумента, первый, входной файл, а второй выходной. Трансляция происходит в несколько проходов, в 1 выставляются адреса команд, и меток, а во второй, команды пишутся в копию памяти, потом память собирается в один бинарный файл.
<h2>Модель процессора</h2>

<img src="./img/ак%20лаб3_page-0001.jpg">

Описание регистров:
1. r1, r2, r3, r4 - регистры, доступные для использования программисту.
2. sr - регистр состояния процессора, в котором хранятся флаги состояния процессора.
3. br - регистр, буфер, вспомогательный регистр для временного хранения данных микропрограммой.
4. dr - регистр данных, туда пишутся данные, которые получены или будут записаны во внешние устройства или в память.
5. cr - регистр команд, в котором лежит исполняемая сейчас команда.
6. ip - счётчик команд.
7. sp - регистр, в котором лежит адрес вершины стека.
8. ar - регистр адреса.

Программа процессора принимает на вход 2 обязательных файла, файл программы, и файл куда писать результат. И еще один не обязательный файл, в котором лежат входные данные для программы.

<h2>Тесты</h2>
Реализовано 4 теста:
1. echo - повторяет полученный на вход символ
2. function - проверят работу со стеком
3. math - проверка всех математических функций
4. task - решение задачи из варианта

Тесты реализованы с использованием модуля pytest-golden. </br>
Каждый тест имеет по 2 копии, так как иначе на GitHub не работал coverage при работе как с консольной командой, поэтому пришлось добавить тесты вызывающие команды напрямую.

<h3>Алгоритмы:</h3>

| ФИО                               | алг.        | LoC | code инстр. | инстр. | вариант                                                |
|-----------------------------------|-------------|-----|-------------|--------|--------------------------------------------------------|
| Кальвияйнен Ярослав Олегович  | task (prob2)    | 27  | 24          | 456    | asm , cisc, harv, hw, instr, binary, stream, mem, prob2 |
| Кальвияйнен Ярослав Олегович  | echo            | 3  | 3          | 3    | asm , cisc, harv, hw, instr, binary, stream, mem, prob2 |
| Кальвияйнен Ярослав Олегович  | factorial        | 14  | 12          | 53    | asm , cisc, harv, hw, instr, binary, stream, mem, prob2 |

